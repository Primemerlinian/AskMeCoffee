<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<section>
	<p>From the notes of <%= drink.owner.name %>...</p>
  <h1>🥤<%= drink.name %></h1>
  <h2>This drink is <%= drink.iced ? 'iced' : 'hot' %></h2>
  <h3> Sweetness rating of <%= drink.sweetnessRating %> </h3>
  <% if (user) { %>
    <form 
      action="/drinks/<%= drink._id %>/flip-iced?_method=PATCH" 
      method="POST">
      <button class="btn" type="submit">
        Make Drink <%= drink.iced ? 'hot' : 'iced' %>
      </button>
    </form>
  <% } %>
  <% if (drink.owner.equals(user?.profile._id)) { %>  
    <a href="/drinks/<%= drink._id %>/edit">
      <button class="btn">Edit this Drink ✎</button>
    </a>
    <form action="/drinks/<%= drink._id %>?_method=DELETE" method="POST">
      <button class="btn" type="submit">🗑️</button>
    </form>
    <% } %>
    <% if (user) { %>
      <h3>Add a comment</h3>
      <form action="/drinks/<%= drink._id %>/comments" method="POST">
        <textarea name="content"></textarea><br>
        <button>Add Comment</button>
      </form>
      <% } %>
      <h2>Comments</h2>
      <ul>
        <% drink.comments?.forEach(comment => { %>
          <li>
            <%= comment.content %> - <%= comment.commenter.name %>
            <% if (comment.commenter.equals(user?.profile)) { %>
              <form 
                action="/drinks/<%= drink._id %>/comments/<%= comment._id %>?_method=DELETE" 
                method="POST"
                class="inline"
              >
                <button class="btn" type="submit">Delete Comment</button>
              </form>
              <a href="/drinks/<%= drink._id %>/comments/<%= comment._id %>/edit">
                <button class="btn">Edit Comment</button>
              </a>
            <% } %> 
          </li> 
        <% }) %>
      </ul>
</section>

<%- include('../partials/footer') %>